#!/usr/bin/env bash
# Check replication lag for PostgreSQL 17 replica on hal9000
set -euo pipefail

ssh hal9000 "sudo -u postgres psql -h localhost -p 5432 -c \"SELECT pg_is_in_recovery() as is_replica, pg_last_xact_replay_timestamp() as last_replay, now() - pg_last_xact_replay_timestamp() as lag;\""
